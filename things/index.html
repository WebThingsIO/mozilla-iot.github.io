<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Mozilla IoT - Things Framework</title>
    <link rel="icon" href="../images/icon.png" type="image/png" />
    <link rel="stylesheet" type="text/css" href="../css/site.css" />
    <link rel="stylesheet" type="text/css" href="css/things.css" />
    <link rel="stylesheet" type="text/css" href="css/prism.css" />
    <link rel="stylesheet" media="(max-width: 959px)" href="../css/site-mobile.css" />
    <link rel="stylesheet" media="(max-width: 959px)" href="css/things-mobile.css" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@mozilla" />
    <meta property="og:title" content="Things Framework by Mozilla" />
    <meta property="og:description" content="Build your own web things" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://iot.mozilla.org/things" />
    <meta property="og:image" content="https://iot.mozilla.org/things/images/things_framework_banner.png" />
    <script src="/js/site.js"></script>
    <script src="/js/analytics.js"></script>
    <script src="js/prism.js"></script>
    <script src="js/tabs.js"></script>
    <script>
      /**
      * Track clicks on outbound links (e.g. download).
      */
      var trackOutboundLink = function(url) {
        document.location = url;
      };
      if (!Mozilla.dntEnabled()) {
        trackOutboundLink = function(url) {
          ga('send', 'event', 'outbound', 'click', url, {
            'transport': 'beacon',
            'hitCallback': function(){document.location = url;}
          });
        }
      }
    </script>
  </head>
  <body>
    <header>
      <a href="/">
        <img id="wordmark" src="/images/mozilla_iot_wordmark.png" alt="Mozilla IoT">
      </a>
      <nav id="main-menu" >
        <a href="/about">About</a>
        <a href="/gateway">Gateway</a>
        <a href="/things" class="selected">Things</a>
        <a href="/specification">API</a>
        <a href="https://hacks.mozilla.org/category/web-of-things/">Blog</a>
        <a href="/contribute">Get Involved</a>
      </nav>
      <a id="menu-button"></a>
    </header>
    <section id="things-framework-intro">
      <h1>Build Your Own Web Things</h1>
      <p class="subtitle">Connect your devices to the Web of Things</p>
      <div class="column"><img src="images/things.png" /></div>
      <div class="column">
        <p>The Things Framework is a collection of re-usable software components to help you build your own web things, which directly expose the <a href="/specification">Web Thing API</a>. This means they can be discovered by a Web of Things gateway or client, which can then automatically detect the device's capabilities and monitor and control it over the web.</p>
      </div>
      <h2><strong>Things</strong> Framework <span class="by-mozilla">by Mozilla</span></h2>
    </section>
    <section id="things-framework">
      <div id="things-framework-content">

        <section id="installation">
          <h2>Installation</h2>
          <ul id="installation-tabs" class="tabs">
            <li><a id="installation-tab-node" class="selected" href="#installation-node" data-section="installation-node">NodeJS</a></li>
            <li><a id="installation-tab-python" href="#installation-python" data-section="installation-python">Python</a></li>
            <li><a id="installation-tab-java" href="#installation-java" data-section="installation-java">Java</a></li>
          </ul>
          <div class="tab-sections">
            <section class="selected" id="installation-node">
              <p>
                <pre><code class="language-bash">$ npm install webthing</code></pre>
              </p>
            </section>
            <section id="installation-python">
              <p>
                <pre><code class="language-bash">$ pip install webthing</code></pre>
              </p>
            </section>
            <section id="installation-java">
              <p>Maven:
<pre><code class="language-markup">&lt;dependencies&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.mozilla.iot&lt;/groupId&gt;
        &lt;artifactId&gt;webthing&lt;/artifactId&gt;
        &lt;version&gt;CURRENT_VERSION&lt;/version&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;
</code></pre>
              </p>
              <p>Gradle:
<pre><code class="language-json">dependencies {
    runtime(
        [group: 'org.mozilla.iot', name: 'webthing', version: 'CURRENT_VERSION'],
    )
}</code></pre>
              </p>
            </section>
          </div>
        </section>

        <section id="example">
          <h2>Example</h2>
          <ul id="example-tabs" class="tabs">
            <li><a id="example-tab-node" class="selected" href="#example-node" data-section="example-node">NodeJS</a></li>
            <li><a id="example-tab-python" href="#example-python" data-section="example-python">Python</a></li>
            <li><a id="example-tab-java" href="#example-java" data-section="example-java">Java</a></li>
            <li><a id="example-tab-esp8266" href="#example-esp8266" data-section="example-esp8266">ESP8266</a></li>
          </ul>
          <div class="tab-sections">
            <section class="selected" id="example-node">
              <p>
                <pre><code class="language-javascript">const {
  Action,
  Event,
  Property,
  Thing,
  Value,
  WebThingServer,
} = require('webthing');
const uuidv4 = require('uuid/v4');

class OverheatedEvent extends Event {
  constructor(thing, data) {
    super(thing, 'overheated', data);
  }
}

class FadeAction extends Action {
  constructor(thing, input) {
    super(uuidv4(), thing, 'fade', input);
  }

  performAction() {
    return new Promise((resolve) => {
      setTimeout(() => {
        this.thing.setProperty('level', this.input.level);
        this.thing.addEvent(new OverheatedEvent(this.thing, 102));
        resolve();
      }, this.input.duration);
    });
  }
}

function makeThing() {
  const thing = new Thing('My Lamp', 'thing', 'A web connected lamp');

  thing.addProperty(
    new Property(thing,
                 'on',
                 new Value(true, () => {}),
                 {type: 'boolean',
                  description: 'Whether the lamp is turned on'}));
  thing.addProperty(
    new Property(thing,
                 'level',
                 new Value(50, () => {}),
                 {type: 'number',
                  description: 'The level of light from 0-100',
                  minimum: 0,
                  maximum: 100}));

  thing.addAvailableAction(
    'fade',
    {description: 'Fade the lamp to a given level',
     input: {
       type: 'object',
       properties: {
         level: {
           type: 'number',
           minimum: 0,
           maximum: 100,
         },
         duration: {
           type: 'number',
           unit: 'milliseconds',
         },
       },
     }},
    FadeAction);

  thing.addAvailableEvent(
    'overheated',
    {description: 'The lamp has exceeded its safe operating temperature',
     type: 'number',
     unit: 'celsius'});

  return thing;
}

function runServer() {
  const thing = makeThing();

  // If adding more than one thing here, be sure to set the second
  // parameter to some string, which will be broadcast via mDNS.
  // In the single thing case, the thing's name will be broadcast.
  const server = new WebThingServer([thing], null, 8888);

  process.on('SIGINT', () => {
    server.stop();
    process.exit();
  });

  server.start();
}

runServer();
                </code></pre>
              </p>
            </section>
            <section id="example-python">
              <p>
<pre><code class="language-python">import time
import uuid

from webthing import Action, Event, Property, Thing, Value, WebThingServer


class OverheatedEvent(Event):

    def __init__(self, thing, data):
        Event.__init__(self, thing, 'overheated', data=data)


class FadeAction(Action):

    def __init__(self, thing, input_):
        Action.__init__(self, uuid.uuid4().hex, thing, 'fade', input_=input_)

    def perform_action(self):
        time.sleep(self.input['duration'] / 1000)
        self.thing.set_property('level', self.input['level'])
        self.thing.add_event(OverheatedEvent(self.thing, 102))


def make_thing():
    thing = Thing(name='My Lamp', description='A web connected lamp')

    def noop(_):
        pass

    thing.add_property(
        Property(thing,
                 'on',
                 Value(True, noop),
                 metadata={
                     'type': 'boolean',
                     'description': 'Whether the lamp is turned on',
                 }))
    thing.add_property(
        Property(thing,
                 'level',
                 Value(50, noop),
                 metadata={
                     'type': 'number',
                     'description': 'The level of light from 0-100',
                     'minimum': 0,
                     'maximum': 100,
                 }))

    thing.add_available_action(
        'fade',
        {'description': 'Fade the lamp to a given level',
         'input': {
             'type': 'object',
             'properties': {
                 'level': {
                     'type': 'number',
                     'minimum': 0,
                     'maximum': 100,
                 },
                 'duration': {
                     'type': 'number',
                     'unit': 'milliseconds',
                 },
             },
         }},
        FadeAction)

    thing.add_available_event(
        'overheated',
        {'description': 'The lamp has exceeded its safe operating temperature',
         'type': 'number',
         'unit': 'celsius'})

    return thing


def run_server():
    thing = make_thing()

    # If adding more than one thing here, be sure to set the `name`
    # parameter to some string, which will be broadcast via mDNS.
    # In the single thing case, the thing's name will be broadcast.
    server = WebThingServer([thing], port=8888)
    try:
        server.start()
    except KeyboardInterrupt:
        server.stop()


if __name__ == '__main__':
    run_server()

</code></pre>
              </p>
            </section>
            <section id="example-java">
              <p>
<pre><code class="language-java">package org.mozilla.iot.webthing.example;

import org.json.JSONObject;
import org.mozilla.iot.webthing.Action;
import org.mozilla.iot.webthing.Event;
import org.mozilla.iot.webthing.Property;
import org.mozilla.iot.webthing.Thing;
import org.mozilla.iot.webthing.Value;
import org.mozilla.iot.webthing.WebThingServer;

import java.io.IOException;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.UUID;

public class SingleThing {
    public static Thing makeThing() {
        Thing thing = new Thing("My Lamp", "thing", "A web connected lamp");

        Map<String, Object> onDescription = new HashMap&lt;&gt;();
        onDescription.put("type", "boolean");
        onDescription.put("description", "Whether the lamp is turned on");
        // noop for state change
        thing.addProperty(new Property(thing, "on", new Value(true, on -> {
        }), onDescription));

        Map<String, Object> levelDescription = new HashMap&lt;&gt;();
        levelDescription.put("type", "number");
        levelDescription.put("description", "The level of light from 0-100");
        levelDescription.put("minimum", 0);
        levelDescription.put("maximum", 100);
        // noop consumer for level
        thing.addProperty(new Property(thing, "level", new Value(50, level -> {
        }), levelDescription));

        Map<String, Object> fadeMetadata = new HashMap&lt;&gt;();
        Map<String, Object> fadeInput = new HashMap&lt;&gt;();
        Map<String, Object> fadeProperties = new HashMap&lt;&gt;();
        Map<String, Object> fadeLevel = new HashMap&lt;&gt;>();
        Map<String, Object> fadeDuration = new HashMap&lt;&gt;>();
        fadeMetadata.put("description", "Fade the lamp to a given level");
        fadeInput.put("type", "object");
        fadeLevel.put("type", "number");
        fadeLevel.put("minimum", 0);
        fadeLevel.put("maximum", 100);
        fadeDuration.put("type", "number");
        fadeDuration.put("unit", "milliseconds");
        fadeProperties.put("level", fadeLevel);
        fadeProperties.put("duration", fadeDuration);
        fadeInput.put("properties", fadeProperties);
        fadeMetadata.put("input", fadeInput);
        thing.addAvailableAction("fade", fadeMetadata, FadeAction.class);

        Map<String, Object> overheatedMetadata = new HashMap&lt;&gt;>();
        overheatedMetadata.put("description",
                               "The lamp has exceeded its safe operating temperature");
        overheatedMetadata.put("type", "number");
        overheatedMetadata.put("unit", "celsius");
        thing.addAvailableEvent("overheated", overheatedMetadata);

        return thing;
    }

    public static void main(String[] args) {
        Thing thing = makeThing();
        WebThingServer server;

        try {
            List<Thing> things = new ArrayList&lt;&gt;();
            things.add(thing);

            // If adding more than one thing here, be sure to set the second
            // parameter to some string, which will be broadcast via mDNS.
            // In the single thing case, the thing's name will be broadcast.
            server = new WebThingServer(things, null, 8888);

            Runtime.getRuntime().addShutdownHook(new Thread() {
                public void run() {
                    server.stop();
                }
            });

            server.start(false);
        } catch (IOException e) {
            System.out.println(e);
            System.exit(1);
        }
    }

    public static class OverheatedEvent extends Event {
        public OverheatedEvent(Thing thing, int data) {
            super(thing, "overheated", data);
        }
    }

    public static class FadeAction extends Action {
        public FadeAction(Thing thing, JSONObject input) {
            super(UUID.randomUUID().toString(), thing, "fade", input);
        }

        @Override
        public void performAction() {
            Thing thing = this.getThing();
            JSONObject input = this.getInput();
            try {
                Thread.sleep(input.getInt("duration"));
            } catch (InterruptedException e) {
            }

            thing.setProperty("level", input.getInt("level"));
            thing.addEvent(new OverheatedEvent(thing, 102));
        }
    }
}
</code></pre>
              </p>
            </section>
            <section id="example-esp8266">
              <p>
<pre><code class="language-cpp">#include &lt;ESP8266WiFi.h&gt;
#include &lt;WiFiClient.h&gt;
#include &lt;Thing.h&gt;
#include &lt;WebThingAdapter.h&gt;

const char* ssid = "......";
const char* password = "..........";

const int lampPin = LED_BUILTIN;

WebThingAdapter adapter("esp8266");

ThingDevice lamp("lamp", "My Lamp", "dimmableLight");

ThingProperty lampOn("on", "Whether the lamp is turned on", BOOLEAN);
ThingProperty lampLevel("level", "The level of light from 0-100", NUMBER);

void setup(void){
  pinMode(lampPin, OUTPUT);
  digitalWrite(lampPin, HIGH);
  Serial.begin(115200);
  WiFi.mode(WIFI_STA);
  WiFi.begin(ssid, password);
  Serial.println("");

  // Wait for connection
  while (WiFi.status() != WL_CONNECTED) {
    delay(500);
    Serial.print(".");
  }

  Serial.println("");
  Serial.print("Connected to ");
  Serial.println(ssid);
  Serial.print("IP address: ");
  Serial.println(WiFi.localIP());

  lamp.addProperty(&amp;lampOn);
  lamp.addProperty(&amp;lampLevel);
  adapter.addDevice(&amp;lamp);
  adapter.begin();
  Serial.println("HTTP server started");

  analogWriteRange(255);
}

void loop(void){
  adapter.update();
  if (lampOn.getValue().boolean) {
    int level = map(lampLevel.getValue().number, 0, 100, 255, 0);
    analogWrite(lampPin, level);
  }
}
</code></pre>
              </p>
            </section>
          </div>
        </section>

        <section id="libraries">
          <h2>Find Out More</h2>
          <div class="library">
            <h3>webthing-node</h3>
            <img src="../contribute/images/github.png" />
            <a class="button" href="https://github.com/mozilla-iot/webthing-node">Learn More</a>
          </div>
          <div class="library">
            <h3>webthing-python</h3>
            <img src="../contribute/images/github.png" />
            <a class="button" href="https://github.com/mozilla-iot/webthing-python">Learn More</a>
          </div>
          <div class="library">
            <h3>webthing-java</h3>
            <img src="../contribute/images/github.png" />
            <a class="button" href="https://github.com/mozilla-iot/webthing-java">Learn More</a>
          </div>
          <div class="library">
            <h3>webthing-esp8266</h3>
            <img src="../contribute/images/github.png" />
            <a class="button" href="https://github.com/mozilla-iot/webthing-esp8266">Learn More</a>
          </div>
        </section>
      </div>
    </section>
    <footer>
      <p>from the Emerging Technologies team at</p>
      <a href="https://mozilla.org">
        <img id="mozilla_wordmark" src="/images/mozilla_wordmark.png" alt="Mozilla" />
      </a>
      <ul>
        <li><a href="https://www.mozilla.org/privacy/websites/">Privacy</a></li>
        <li><a href="https://www.mozilla.org/about/legal/">Legal</a></li>
        <li><a href="mailto:iot@mozilla.com">Contact</a></li>
        <li><a href="https://twitter.com/MozillaIoT">Twitter</a></li>
      </ul>
      <small>Portions of this content are ©1998–2017 by individual mozilla.org contributors. Content available under a <a href="https://www.mozilla.org/foundation/licensing/website-content/">Creative Commons license</a>. "Raspberry Pi" is a trademark of the Raspberry Pi Foundation. Raspberry Pi illustration derived from <a href="https://commons.wikimedia.org/wiki/File:Raspberry_Pi_B%2B_illustration.svg">source work</a> licensed <a href="https://creativecommons.org/licenses/by-sa/3.0/deed.en">CC-BY-SA-3.0</a>.</small>
    </footer>
  </body>
</html>
